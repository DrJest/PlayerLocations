	# PlayerLocations

This Bukkit/Spigot plugin saves players' locations in a JSON File. 
It's built on top of [Bukkit](https://bukkit.org/) 1.12.2 APIs.

#### Get Started
You can import this whole repository inside [Eclipse](https://eclipse.org/) and compile it with Maven, or you can just download the ```target/PlayerLocations/0.1.jar``` and place it inside the ```plugins``` folder of your Bukkit/Spigot server.

#### Configurations
PlayerLocations as few parameters. You can change them by editing the ```config.yml``` inside this plugin's data folder.

| Parameter | Type | Value | Default |
| --------- | ---- | ----- | ------- |
| outputFile | String | Where to place the JSON file with output. **\_DATA\_FOLDER\_** in this context means plugin's data folder | **\_DATA\_FOLDER\_**/players.json |
| offlinePlayersFile | String | This is the file this plugin uses to save offline players' location **\_DATA\_FOLDER\_** in this context means plugin's data folder | **\_DATA\_FOLDER\_**/offline.json |
| saveOfflinePlayers | boolean | Whether to save, and thus show, offline players' location | true | showVanishedPlayers | boolean | Whether to show vanished players' location | false |
| showSneakingPlayers | boolean | Whether to show sneaking players' location | false |
| showInvisiblePlayers | boolean | Whether to show invisible players' location | false |
| showSpectatorPlayers | boolean | Whether to show spectators' location | false |
| Mapping | Map<String, String> | Allows to change the world name in the JSON file | |

## WEB
```web/playerlocations.js``` contains a possible application of this plugin: a script that shows Players' Locations on a [Overviewer](https://overviewer.org) Map.

#### Get Started
To use this script just copy the ```web/playerlocations.js``` file inside your Overviewer root, then open ```index.html``` and add the following line before the `</body>` tag

```HTML
<script src="playermarkers.js" type="text/javascript"></script>
```
Make sure you mapped your world's name correctly in Plugin Configuration.

#### Configuration
To edit options just change properly `pmOptions` at `playerlocations.js:1`.

| Parameter | Type | Value | Default |
| --------- | ---- | ----- | ------- |
| markersFile | String | The path to the JSON file generated by the plugin | /players.json |
| refreshRate | int | Time (in milliseconds) between markers' refresh | 1000 |
| skinUrl | String | Use this field to use a web service to show real players' faces instead of Steve's one. In this context **{u}** represent player's name, **{s}** the size of the image. See PHP for further informations. | |
| showOfflinePlayers | boolean | Whether to show offline players by default | false |
| followPlayer | String | The name of the player to follow by default | |

#### Preserve `playermarkers.js` on Overviewer world re-generation
To avoid Overviewer to delete `playerlocations.js` every time you regenerate the world, I suggest to use your webserver's configuration to place PlayerLocations' file in another folder.

E.G.
Overviewer exports world in `/srv/www/`
Place `playerlocations.js` inside `/srv/playerlocations/`. Then you can config your webserver to inject the script directly inside `/srv/www/index.html`:
##### Nginx
```nginx
server {
        ...
        root /srv/www;
        index index.html;
    .   ...
        location /index.html {
                sub_filter '</body>' '<script type="text/javascript" src="playerlocations/playerlocations.js"></script></body>';
                sub_filter_once on;
        }
        location /playerlocations {
                root /srv;
        }
}
```

##### APACHE
```Apache
<Location "/index.html">
    AddOutputFilterByType SUBSTITUTE text/html
    Substitute "s/\<\/body\>/<script type="text\/javascript" src="playerlocations\/playerlocations.js"><\/script><\/body>/"
</Location>
Alias /playerlocations /srv/playerlocations
```

### Skin generator
`web/PHP/skin.php` contains a simple, out-of-the-box skin generator. Just place it on your server and edit `skinUrl` in `playerlocations.js` options.

# Contribution
PRs are welcome! 

# Issues
If you need help just open an on https://github.com/drjest/playerlocations 


	